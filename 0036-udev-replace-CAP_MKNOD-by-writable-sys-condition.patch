From bb8f5a48fef4adbe1a8bd57eb8a8d1d346447781 Mon Sep 17 00:00:00 2001
From: Kay Sievers <kay@vrfy.org>
Date: Sat, 17 Aug 2013 19:07:42 +0200
Subject: [PATCH] udev: replace CAP_MKNOD by writable /sys condition

---
 units/systemd-udev-settle.service.in  | 2 +-
 units/systemd-udev-trigger.service.in | 2 +-
 units/systemd-udevd-control.socket    | 2 +-
 units/systemd-udevd-kernel.socket     | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/units/systemd-udev-settle.service.in b/units/systemd-udev-settle.service.in
index 037dd9a..0817803 100644
--- a/units/systemd-udev-settle.service.in
+++ b/units/systemd-udev-settle.service.in
@@ -16,7 +16,7 @@ DefaultDependencies=no
 Wants=systemd-udevd.service
 After=systemd-udev-trigger.service
 Before=sysinit.target
-ConditionCapability=CAP_MKNOD
+ConditionPathIsReadWrite=/sys
 
 [Service]
 Type=oneshot
diff --git a/units/systemd-udev-trigger.service.in b/units/systemd-udev-trigger.service.in
index 604c369..0c33909 100644
--- a/units/systemd-udev-trigger.service.in
+++ b/units/systemd-udev-trigger.service.in
@@ -12,7 +12,7 @@ DefaultDependencies=no
 Wants=systemd-udevd.service
 After=systemd-udevd-kernel.socket systemd-udevd-control.socket
 Before=sysinit.target
-ConditionCapability=CAP_MKNOD
+ConditionPathIsReadWrite=/sys
 
 [Service]
 Type=oneshot
diff --git a/units/systemd-udevd-control.socket b/units/systemd-udevd-control.socket
index ca17102..8330a1c 100644
--- a/units/systemd-udevd-control.socket
+++ b/units/systemd-udevd-control.socket
@@ -10,7 +10,7 @@ Description=udev Control Socket
 Documentation=man:systemd-udevd.service(8) man:udev(7)
 DefaultDependencies=no
 Before=sockets.target
-ConditionCapability=CAP_MKNOD
+ConditionPathIsReadWrite=/sys
 
 [Socket]
 Service=systemd-udevd.service
diff --git a/units/systemd-udevd-kernel.socket b/units/systemd-udevd-kernel.socket
index 4b8a5b0..39b7809 100644
--- a/units/systemd-udevd-kernel.socket
+++ b/units/systemd-udevd-kernel.socket
@@ -10,7 +10,7 @@ Description=udev Kernel Socket
 Documentation=man:systemd-udevd.service(8) man:udev(7)
 DefaultDependencies=no
 Before=sockets.target
-ConditionCapability=CAP_MKNOD
+ConditionPathIsReadWrite=/sys
 
 [Socket]
 Service=systemd-udevd.service
